import{_ as v,a as p,c as i,b as t,w as h,j as f,i as y,z as c,F as b,r as P,t as l,g,E as O,o as d,n as m,p as S,k as C,f as u}from"./index-01669123.js";import{a as _,A as k}from"./config-162ba8a8.js";const x={name:"AdminOrders",data(){return{orders:[],searchQuery:"",filterStatus:"",currentPage:1,totalPages:1,showModal:!1,selectedOrder:null,form:{status:"",payment_status:""}}},mounted(){this.fetchOrders()},methods:{async fetchOrders(){try{const n=localStorage.getItem("token"),a=await p.get(`${_}/orders`,{params:{page:this.currentPage,q:this.searchQuery,status:this.filterStatus},headers:{Authorization:`Bearer ${n}`}});a.data.status&&(this.orders=a.data.data.data,this.totalPages=a.data.data.last_page)}catch(n){console.error("Error fetching orders:",n)}},getProductImage(n){if(n.san_pham&&n.san_pham.hinh_anh)try{const a=JSON.parse(n.san_pham.hinh_anh);return Array.isArray(a)&&a.length>0?k+a[0]:"https://via.placeholder.com/50"}catch{return"https://via.placeholder.com/50"}return"https://via.placeholder.com/50"},formatCurrency(n){return new Intl.NumberFormat("vi-VN",{style:"currency",currency:"VND"}).format(n)},formatDate(n){return n?new Date(n).toLocaleString("vi-VN"):""},getStatusLabel(n){return{pending:"Chờ xác nhận",processing:"Đang xử lý",shipped:"Đang giao",delivered:"Đã giao",completed:"Hoàn thành",cancelled:"Đã hủy"}[n]||n},getPaymentStatusLabel(n){return{pending:"Chờ thanh toán",awaiting_payment:"Đang chờ",paid:"Đã thanh toán",completed:"Hoàn tất",failed:"Thất bại"}[n]||n},openEditModal(n){this.selectedOrder=n,this.form={status:n.status,payment_status:n.payment_status},this.showModal=!0},closeModal(){this.showModal=!1,this.selectedOrder=null},async updateOrder(){try{const n=localStorage.getItem("token");await p.put(`${_}/orders/${this.selectedOrder.id}/status`,this.form,{headers:{Authorization:`Bearer ${n}`}}),this.closeModal(),this.fetchOrders(),alert("Cập nhật đơn hàng thành công")}catch(n){console.error("Error updating order:",n),alert("Lỗi khi cập nhật đơn hàng")}},changePage(n){this.currentPage=n,this.fetchOrders()}}},r=n=>(S("data-v-88827e38"),n=n(),C(),n),M={class:"orders-page"},w=r(()=>t("h2",{class:"page-title"},"Quản lý đơn hàng",-1)),I={class:"toolbar"},N=u('<option value="" data-v-88827e38>Tất cả trạng thái</option><option value="pending" data-v-88827e38>Chờ xác nhận</option><option value="processing" data-v-88827e38>Đang xử lý</option><option value="shipped" data-v-88827e38>Đang giao</option><option value="delivered" data-v-88827e38>Đã giao</option><option value="completed" data-v-88827e38>Hoàn thành</option><option value="cancelled" data-v-88827e38>Đã hủy</option>',7),T=[N],L={class:"table-container"},V={class:"data-table"},A=r(()=>t("thead",null,[t("tr",null,[t("th",null,"Mã đơn"),t("th",null,"Người mua"),t("th",null,"Sản phẩm"),t("th",null,"Tổng tiền"),t("th",null,"Thanh toán"),t("th",null,"Trạng thái"),t("th",null,"Ngày đặt"),t("th",null,"Hành động")])],-1)),D={class:"product-info"},H=["src"],E={class:"actions"},U=["onClick"],B=r(()=>t("i",{class:"fas fa-edit"},null,-1)),Q=[B],z={key:0,class:"pagination"},F=["disabled"],K=["disabled"],R={key:1,class:"modal-overlay"},j={class:"modal-content"},q={class:"form-group"},J=r(()=>t("label",null,"Trạng thái đơn hàng",-1)),G=u('<option value="pending" data-v-88827e38>Chờ xác nhận</option><option value="processing" data-v-88827e38>Đang xử lý</option><option value="shipped" data-v-88827e38>Đang giao</option><option value="delivered" data-v-88827e38>Đã giao</option><option value="completed" data-v-88827e38>Hoàn thành</option><option value="cancelled" data-v-88827e38>Đã hủy</option>',6),W=[G],X={class:"form-group"},Y=r(()=>t("label",null,"Trạng thái thanh toán",-1)),Z=u('<option value="pending" data-v-88827e38>Chờ thanh toán</option><option value="awaiting_payment" data-v-88827e38>Đang chờ thanh toán</option><option value="paid" data-v-88827e38>Đã thanh toán</option><option value="completed" data-v-88827e38>Hoàn tất</option><option value="failed" data-v-88827e38>Thất bại</option>',5),$=[Z],tt={class:"modal-actions"},et=r(()=>t("button",{type:"submit",class:"btn btn-primary"},"Lưu",-1));function nt(n,a,at,st,s,o){return d(),i("div",M,[w,t("div",I,[h(t("input",{type:"text","onUpdate:modelValue":a[0]||(a[0]=e=>s.searchQuery=e),onKeyup:a[1]||(a[1]=y((...e)=>o.fetchOrders&&o.fetchOrders(...e),["enter"])),placeholder:"Mã đơn, tên người mua, sđt...",class:"search-input"},null,544),[[f,s.searchQuery]]),h(t("select",{"onUpdate:modelValue":a[2]||(a[2]=e=>s.filterStatus=e),onChange:a[3]||(a[3]=(...e)=>o.fetchOrders&&o.fetchOrders(...e)),class:"status-filter"},T,544),[[c,s.filterStatus]]),t("button",{onClick:a[4]||(a[4]=(...e)=>o.fetchOrders&&o.fetchOrders(...e)),class:"btn btn-primary"},"Tìm kiếm")]),t("div",L,[t("table",V,[A,t("tbody",null,[(d(!0),i(b,null,P(s.orders,e=>(d(),i("tr",{key:e.id},[t("td",null,l(e.ma_don_hang),1),t("td",null,[t("div",null,l(e.buyer_name),1),t("small",null,l(e.buyer_phone),1)]),t("td",null,[t("div",D,[t("img",{src:o.getProductImage(e),alt:"Product",class:"product-thumb"},null,8,H),t("span",null,l(e.san_pham?e.san_pham.ten_san_pham:"Sản phẩm đã xóa"),1)])]),t("td",null,l(o.formatCurrency(e.tong_tien)),1),t("td",null,[t("span",{class:m(["payment-badge",e.payment_status])},l(o.getPaymentStatusLabel(e.payment_status)),3)]),t("td",null,[t("span",{class:m(["status-badge",e.status])},l(o.getStatusLabel(e.status)),3)]),t("td",null,l(o.formatDate(e.created_at)),1),t("td",E,[t("button",{onClick:ot=>o.openEditModal(e),class:"btn-icon",title:"Cập nhật trạng thái"},Q,8,U)])]))),128))])])]),s.totalPages>1?(d(),i("div",z,[t("button",{disabled:s.currentPage===1,onClick:a[5]||(a[5]=e=>o.changePage(s.currentPage-1))}," « ",8,F),t("span",null,"Trang "+l(s.currentPage)+" / "+l(s.totalPages),1),t("button",{disabled:s.currentPage===s.totalPages,onClick:a[6]||(a[6]=e=>o.changePage(s.currentPage+1))}," » ",8,K)])):g("",!0),s.showModal?(d(),i("div",R,[t("div",j,[t("h3",null,"Cập nhật đơn hàng #"+l(s.selectedOrder.ma_don_hang),1),t("form",{onSubmit:a[10]||(a[10]=O((...e)=>o.updateOrder&&o.updateOrder(...e),["prevent"]))},[t("div",q,[J,h(t("select",{"onUpdate:modelValue":a[7]||(a[7]=e=>s.form.status=e),class:"form-control"},W,512),[[c,s.form.status]])]),t("div",X,[Y,h(t("select",{"onUpdate:modelValue":a[8]||(a[8]=e=>s.form.payment_status=e),class:"form-control"},$,512),[[c,s.form.payment_status]])]),t("div",tt,[t("button",{type:"button",onClick:a[9]||(a[9]=(...e)=>o.closeModal&&o.closeModal(...e)),class:"btn btn-secondary"},"Hủy"),et])],32)])])):g("",!0)])}const it=v(x,[["render",nt],["__scopeId","data-v-88827e38"]]);export{it as default};
