import{_ as ce,l as de,m as b,q as Q,C as re,s as ue,y as pe,c,b as e,E as j,h,d as he,e as me,g as _,t as v,w as m,j as y,n as C,z as K,F as A,r as E,H as O,i as _e,a as R,o as d,p as ge,k as be}from"./index-01669123.js";const l=T=>(ge("data-v-77501921"),T=T(),be(),T),ve={class:"container py-4"},fe={class:"row g-4"},ye={class:"col-lg-8"},ke=["onSubmit"],xe={class:"card-body p-4"},we={key:0,class:"alert alert-info mb-3"},Se=l(()=>e("span",{class:"spinner-border spinner-border-sm me-2",role:"status","aria-hidden":"true"},null,-1)),Ve={key:1,class:"alert alert-warning mb-3"},Ce=l(()=>e("i",{class:"bi bi-exclamation-triangle me-2"},null,-1)),Te={class:"d-flex justify-content-between align-items-center mb-3"},Ue=l(()=>e("h3",{class:"m-0 fw-bold"},"Đăng bán sản phẩm",-1)),$e={class:"d-flex gap-2"},Ie=["disabled"],Be={key:0,class:"spinner-border spinner-border-sm me-1",role:"status","aria-hidden":"true"},De={class:"mb-4"},Ne=l(()=>e("h6",{class:"text-uppercase text-muted mb-3"},"Thông tin cơ bản",-1)),Pe={class:"row g-3"},Me={class:"col-12"},je=l(()=>e("label",{class:"form-label"},[h("Tiêu đề "),e("span",{class:"text-danger"},"*")],-1)),Ae=["disabled"],Ee={key:0,class:"invalid-feedback"},Le={class:"col-md-6"},qe=l(()=>e("label",{class:"form-label"},[h("Danh mục "),e("span",{class:"text-danger"},"*")],-1)),Ge=["disabled"],Ke={value:"",disabled:""},Oe=["value"],Re={key:0,class:"invalid-feedback"},ze={class:"col-md-6"},Fe=l(()=>e("label",{class:"form-label"},"Tình trạng",-1)),He=["disabled"],Je=l(()=>e("option",{value:"new"},"Mới 100%",-1)),Xe=l(()=>e("option",{value:"likenew"},"Như mới (99%)",-1)),We=l(()=>e("option",{value:"good"},"Tốt",-1)),Qe=l(()=>e("option",{value:"fair"},"Khá",-1)),Ye=[Je,Xe,We,Qe],Ze={class:"col-12"},et=l(()=>e("label",{class:"form-label"},[h("Mô tả "),e("span",{class:"text-danger"},"*")],-1)),tt=["disabled"],st={class:"d-flex justify-content-between small mt-1"},nt={key:0,class:"text-danger"},ot={class:"text-muted"},lt={class:"col-md-6"},at=l(()=>e("label",{class:"form-label"},[h("Giá "),e("span",{class:"text-danger"},"*")],-1)),it={class:"input-group"},ct=l(()=>e("span",{class:"input-group-text"},"₫",-1)),dt=["disabled"],rt=l(()=>e("div",{class:"form-text"},'Bật "Thương lượng" nếu linh hoạt giá.',-1)),ut={key:0,class:"invalid-feedback d-block"},pt={class:"form-check mt-2"},ht=["disabled"],mt=l(()=>e("label",{class:"form-check-label",for:"negotiable"},"Cho phép thương lượng",-1)),_t={class:"col-md-3"},gt=l(()=>e("label",{class:"form-label"},"Số lượng",-1)),bt=["disabled"],vt={class:"col-md-3"},ft=l(()=>e("label",{class:"form-label"},"Tỉnh/Thành",-1)),yt=["disabled"],kt={class:"mb-4"},xt=l(()=>e("h6",{class:"text-uppercase text-muted mb-3"},[h("Hình ảnh sản phẩm "),e("span",{class:"text-danger"},"*")],-1)),wt=["disabled"],St=["disabled"],Vt=l(()=>e("span",{class:"text-muted"},"Kéo thả ảnh vào đây (PNG/JPG, < 5MB)",-1)),Ct={key:0,class:"row g-3 mt-2"},Tt={class:"position-relative border rounded-3 overflow-hidden"},Ut=["src","alt"],$t={class:"position-absolute bottom-0 start-0 end-0 p-2 bg-dark bg-opacity-25 d-flex justify-content-between"},It=["onClick","disabled"],Bt=["onClick"],Dt={key:0,class:"small text-success mt-1"},Nt={key:1,class:"invalid-feedback d-block"},Pt={class:"mb-4"},Mt=l(()=>e("h6",{class:"text-uppercase text-muted mb-3"},"Chi tiết bổ sung",-1)),jt={class:"row g-3"},At={class:"col-md-6"},Et=l(()=>e("label",{class:"form-label"},"Thương hiệu",-1)),Lt={class:"col-md-6"},qt=l(()=>e("label",{class:"form-label"},"Model/Mã SP",-1)),Gt={class:"col-12"},Kt=l(()=>e("label",{class:"form-label"},"Từ khóa",-1)),Ot={class:"input-group"},Rt=["onKeyup"],zt={class:"mt-2"},Ft=["onClick"],Ht={class:"mb-3"},Jt=l(()=>e("h6",{class:"text-uppercase text-muted mb-3"},"Vận chuyển & Liên hệ",-1)),Xt={class:"row g-3"},Wt={class:"col-md-6"},Qt=l(()=>e("label",{class:"form-label"},"Hình thức giao",-1)),Yt=l(()=>e("option",{value:"meet"},"Gặp trực tiếp",-1)),Zt=l(()=>e("option",{value:"ship"},"Ship COD",-1)),es=l(()=>e("option",{value:"both"},"Cả hai",-1)),ts=[Yt,Zt,es],ss={key:0,class:"col-md-6"},ns=l(()=>e("label",{class:"form-label"},"Phí ship (ước tính)",-1)),os={class:"input-group"},ls=l(()=>e("span",{class:"input-group-text"},"₫",-1)),as={class:"col-md-6"},is=l(()=>e("label",{class:"form-label"},"SĐT liên hệ",-1)),cs={class:"col-md-6 d-flex align-items-end"},ds={class:"form-check"},rs=l(()=>e("label",{class:"form-check-label",for:"hidePhone"},"Ẩn số, chỉ chat qua ứng dụng",-1)),us={class:"mb-3"},ps={class:"form-check"},hs=l(()=>e("label",{class:"form-check-label",for:"policy"},[h(" Tôi đồng ý với "),e("a",{href:"#"},"Chính sách đăng bán"),h(" & "),e("a",{href:"#"},"Điều khoản sử dụng"),h(". ")],-1)),ms={key:0,class:"invalid-feedback d-block"},_s={class:"d-flex justify-content-end gap-2"},gs=["disabled"],bs={class:"col-lg-4"},vs={class:"card border-0 shadow-sm position-sticky",style:{top:"20px"}},fs={class:"card-body"},ys=l(()=>e("div",{class:"d-flex justify-content-between align-items-center mb-2"},[e("h5",{class:"m-0"},"Xem nhanh"),e("span",{class:"badge text-bg-success-subtle text-success"},"Bản nháp")],-1)),ks={key:0,class:"mb-3"},xs=["src"],ws={class:"list-unstyled small m-0"},Ss={class:"mb-1"},Vs=l(()=>e("span",{class:"text-muted"},"Tiêu đề:",-1)),Cs={class:"mb-1"},Ts=l(()=>e("span",{class:"text-muted"},"Danh mục:",-1)),Us={class:"mb-1"},$s=l(()=>e("span",{class:"text-muted"},"Giá:",-1)),Is={class:"mb-1"},Bs=l(()=>e("span",{class:"text-muted"},"Địa điểm:",-1)),Ds={key:1,class:"mt-2"},Ns={__name:"index",setup(T){const x=de(),L="/api/client",U=b([]),$=b(!1),s=Q({title:"",description:"",category:"",condition:"likenew",price:null,negotiable:!1,quantity:1,brand:"",model:"",tags:[],location:"",shipping:{method:"both",fee:0},contact:{phone:"",hidePhone:!1}}),S=Q({}),w=b(!1),q=b(!1),I=b(!1),u=b(!1),p=b(!1),z=b(null),B=b(!1),f=b([]);function Y(){return typeof crypto<"u"&&crypto.randomUUID?crypto.randomUUID():"img_"+Date.now()+"_"+Math.random().toString(36).substr(2,9)}function Z(o){F(Array.from(o.target.files||[])),o.target.value=""}function ee(o){B.value=!1,F(Array.from(o.dataTransfer.files||[]))}function F(o){for(const t of o){if(!t.type.startsWith("image/")||t.size>5*1024*1024)continue;const i=URL.createObjectURL(t);f.value.push({id:Y(),file:t,url:i})}V("images")}function te(o){const[t]=f.value.splice(o,1);t&&URL.revokeObjectURL(t.url)}function se(o){if(o===0)return;const t=f.value.splice(o,1)[0];f.value.unshift(t)}const D=b("");function H(){const o=D.value.trim();o&&(s.tags.includes(o)||s.tags.push(o),D.value="")}function ne(o){s.tags.splice(o,1)}const oe=re(()=>s.price&&s.price>0?new Intl.NumberFormat("vi-VN").format(s.price)+(s.negotiable?" (TL)":""):"—");function le(o){var t;return(t=U.value.find(i=>i.slug===o))==null?void 0:t.name}function V(o){S[o]=!0}function g(o){switch(o){case"title":return S.title&&!s.title;case"category":return S.category&&!s.category;case"description":return S.description&&!s.description;case"price":return S.price&&(!s.price||s.price<=0);case"images":return S.images&&f.value.length===0;default:return!1}}function N(o){return g(o)?"is-invalid":""}function J(){return localStorage.getItem("key_client")?!0:(k("Vui lòng đăng nhập để đăng bán sản phẩm","error"),setTimeout(()=>{x.push("/dang-nhap")},1500),!1)}async function X(){var t;const o=localStorage.getItem("key_client");if(!o)return!1;p.value=!0;try{const{data:i}=await R.get(`${L}/check-seller-status`,{headers:{Authorization:`Bearer ${o}`}});return i!=null&&i.status&&(i!=null&&i.is_seller)?(u.value=!0,!0):(u.value=!1,k("Bạn chưa đăng ký bán hàng. Vui lòng đăng ký bán hàng trước.","error"),setTimeout(()=>{x.push("/dang-ky-ban")},2e3),!1)}catch(i){return console.error("Error checking seller status:",i),((t=i==null?void 0:i.response)==null?void 0:t.status)===401&&(k("Vui lòng đăng nhập","error"),setTimeout(()=>{x.push("/dang-nhap")},1500)),!1}finally{p.value=!1}}function k(o,t="info"){window.$toast?t==="error"?window.$toast.error(o):t==="success"?window.$toast.success(o):window.$toast.info(o):alert(o)}async function ae(){var o,t,i,n;if(J()&&!(!u.value&&!await X())){if(["title","category","description","price","images"].forEach(V),I.value=!q.value,g("title")||g("category")||g("description")||g("price")||g("images")||I.value){window.scrollTo({top:0,behavior:"smooth"}),I.value&&k("Vui lòng đồng ý với điều khoản sử dụng","error");return}w.value=!0;try{const a=localStorage.getItem("key_client");if(!a){k("Vui lòng đăng nhập","error"),x.push("/dang-nhap");return}const r=new FormData;r.append("title",s.title),r.append("description",s.description),r.append("category",s.category),r.append("condition",s.condition),r.append("price",String(s.price)),r.append("negotiable",s.negotiable?"1":"0"),r.append("quantity",String(s.quantity||1)),s.brand&&r.append("brand",s.brand),s.model&&r.append("model",s.model),s.location&&r.append("location",s.location),r.append("shipping_method",s.shipping.method),r.append("shipping_fee",String(s.shipping.fee||0)),s.contact.phone&&r.append("contact_phone",s.contact.phone),r.append("contact_hide",s.contact.hidePhone?"1":"0"),s.tags.forEach((M,G)=>r.append(`tags[${G}]`,M)),f.value.forEach((M,G)=>r.append("images[]",M.file,M.file.name||`image_${G}.jpg`));const{data:P}=await R.post(`${L}/san-pham`,r,{headers:{"Content-Type":"multipart/form-data",Authorization:`Bearer ${a}`}});localStorage.removeItem("sell_draft"),P!=null&&P.status?(k(P.message||"Đăng bán sản phẩm thành công!","success"),setTimeout(()=>{x.push("/nguoi-ban/san-pham")},1500)):(k("Đăng bán thành công!","success"),setTimeout(()=>{x.push("/nguoi-ban/san-pham")},1500))}catch(a){console.error("Error submitting product:",a);const r=((t=(o=a==null?void 0:a.response)==null?void 0:o.data)==null?void 0:t.message)||(a==null?void 0:a.message)||"Có lỗi xảy ra khi đăng bán sản phẩm";k(r,"error"),((i=a==null?void 0:a.response)==null?void 0:i.status)===403?setTimeout(()=>{x.push("/dang-ky-ban")},2e3):((n=a==null?void 0:a.response)==null?void 0:n.status)===401&&setTimeout(()=>{x.push("/dang-nhap")},2e3)}finally{w.value=!1}}}async function ie(){$.value=!0;try{const{data:o}=await R.get(`${L}/danh-muc`),t=(o==null?void 0:o.data)||o||[];U.value=Array.isArray(t)?t.map(i=>({id:i.id,slug:i.slug,name:i.ten_danh_muc||i.name})):[]}catch(o){console.warn("Không thể tải danh mục",o),U.value=[{slug:"dien-thoai",name:"Điện thoại"},{slug:"sach",name:"Sách"},{slug:"do-dien-tu",name:"Đồ điện tử"},{slug:"may-tinh",name:"Máy tính"},{slug:"thoi-trang",name:"Thời trang"},{slug:"do-gia-dung",name:"Gia dụng"}]}finally{$.value=!1}}function W(){const o={...s,images:[]};localStorage.setItem("sell_draft",JSON.stringify(o)),k("Đã lưu nháp thành công!","success")}return ue(async()=>{if(!J())return;await X();const o=localStorage.getItem("sell_draft");if(o)try{const t=JSON.parse(o);Object.assign(s,t)}catch(t){console.warn("Không thể load draft",t)}ie()}),(o,t)=>{const i=pe("router-link");return d(),c("div",ve,[e("div",fe,[e("div",ye,[e("form",{class:"card border-0 shadow-sm",onSubmit:j(ae,["prevent"])},[e("div",xe,[p.value?(d(),c("div",we,[Se,h(" Đang kiểm tra quyền đăng bán... ")])):u.value?_("",!0):(d(),c("div",Ve,[Ce,h(" Bạn chưa đăng ký bán hàng. Vui lòng "),he(i,{to:"/dang-ky-ban",class:"alert-link"},{default:me(()=>[h("đăng ký bán hàng")]),_:1}),h(" trước khi đăng sản phẩm. ")])),e("div",Te,[Ue,e("div",$e,[e("button",{type:"button",class:"btn btn-outline-secondary",onClick:W},"Lưu nháp"),e("button",{type:"submit",class:"btn btn-success",disabled:w.value||!u.value||p.value},[w.value?(d(),c("span",Be)):_("",!0),h(" "+v(w.value?"Đang đăng...":"Đăng bán"),1)],8,Ie)])]),e("div",De,[Ne,e("div",Pe,[e("div",Me,[je,m(e("input",{type:"text",class:C(["form-control",N("title")]),"onUpdate:modelValue":t[0]||(t[0]=n=>s.title=n),placeholder:"VD: iPhone 13 128GB xanh",onBlur:t[1]||(t[1]=n=>V("title")),disabled:!u.value||p.value},null,42,Ae),[[y,s.title,void 0,{trim:!0}]]),g("title")?(d(),c("div",Ee,"Vui lòng nhập tiêu đề.")):_("",!0)]),e("div",Le,[qe,m(e("select",{class:C(["form-select",N("category")]),"onUpdate:modelValue":t[2]||(t[2]=n=>s.category=n),onChange:t[3]||(t[3]=n=>V("category")),disabled:$.value||!u.value||p.value},[e("option",Ke,v($.value?"Đang tải...":"Chọn danh mục"),1),(d(!0),c(A,null,E(U.value,n=>(d(),c("option",{key:n.slug,value:n.slug},v(n.name),9,Oe))),128))],42,Ge),[[K,s.category]]),g("category")?(d(),c("div",Re,"Chọn danh mục.")):_("",!0)]),e("div",ze,[Fe,m(e("select",{class:"form-select","onUpdate:modelValue":t[4]||(t[4]=n=>s.condition=n),disabled:!u.value||p.value},Ye,8,He),[[K,s.condition]])]),e("div",Ze,[et,m(e("textarea",{class:C(["form-control",N("description")]),rows:"5","onUpdate:modelValue":t[5]||(t[5]=n=>s.description=n),placeholder:"Tình trạng, phụ kiện, lý do bán...",onBlur:t[6]||(t[6]=n=>V("description")),disabled:!u.value||p.value},null,42,tt),[[y,s.description,void 0,{trim:!0}]]),e("div",st,[g("description")?(d(),c("span",nt,"Vui lòng nhập mô tả.")):_("",!0),e("span",ot,v(s.description.length)+"/2000",1)])]),e("div",lt,[at,e("div",it,[ct,m(e("input",{type:"number",min:"0",step:"1000",class:C(["form-control",N("price")]),"onUpdate:modelValue":t[7]||(t[7]=n=>s.price=n),placeholder:"VD: 2500000",onBlur:t[8]||(t[8]=n=>V("price")),disabled:!u.value||p.value},null,42,dt),[[y,s.price,void 0,{number:!0}]])]),rt,g("price")?(d(),c("div",ut,"Nhập giá hợp lệ > 0.")):_("",!0),e("div",pt,[m(e("input",{class:"form-check-input",type:"checkbox","onUpdate:modelValue":t[9]||(t[9]=n=>s.negotiable=n),id:"negotiable",disabled:!u.value||p.value},null,8,ht),[[O,s.negotiable]]),mt])]),e("div",_t,[gt,m(e("input",{type:"number",min:"1",class:"form-control","onUpdate:modelValue":t[10]||(t[10]=n=>s.quantity=n),disabled:!u.value||p.value},null,8,bt),[[y,s.quantity,void 0,{number:!0}]])]),e("div",vt,[ft,m(e("input",{type:"text",class:"form-control","onUpdate:modelValue":t[11]||(t[11]=n=>s.location=n),placeholder:"VD: Đà Nẵng",disabled:!u.value||p.value},null,8,yt),[[y,s.location,void 0,{trim:!0}]])])])]),e("div",kt,[xt,e("div",{class:C(["p-3 border rounded-3 bg-light d-flex align-items-center gap-2",{"border-success":B.value,"opacity-50":!u.value||p.value}]),onDragover:t[13]||(t[13]=j(n=>u.value&&!p.value?B.value=!0:null,["prevent"])),onDragleave:t[14]||(t[14]=j(n=>B.value=!1,["prevent"])),onDrop:t[15]||(t[15]=j(n=>u.value&&!p.value?ee:null,["prevent"]))},[e("input",{ref_key:"fileInput",ref:z,class:"d-none",type:"file",accept:"image/*",multiple:"",onChange:Z,disabled:!u.value||p.value},null,40,wt),e("button",{type:"button",class:"btn btn-outline-success",onClick:t[12]||(t[12]=n=>{var a;return u.value&&!p.value?(a=z.value)==null?void 0:a.click():null}),disabled:!u.value||p.value},"+ Thêm ảnh",8,St),Vt],34),f.value.length?(d(),c("div",Ct,[(d(!0),c(A,null,E(f.value,(n,a)=>(d(),c("div",{class:"col-6 col-sm-4 col-md-3",key:n.id},[e("div",Tt,[e("img",{src:n.url,class:"w-100",style:{height:"140px","object-fit":"cover"},alt:"Ảnh "+(a+1)},null,8,Ut),e("div",$t,[e("button",{type:"button",class:"btn btn-sm btn-light",onClick:r=>se(a),disabled:a===0},"Bìa",8,It),e("button",{type:"button",class:"btn btn-sm btn-outline-danger",onClick:r=>te(a)},"Xóa",8,Bt)])]),a===0?(d(),c("div",Dt,"Ảnh bìa")):_("",!0)]))),128))])):_("",!0),g("images")?(d(),c("div",Nt,"Vui lòng thêm ít nhất 1 ảnh.")):_("",!0)]),e("div",Pt,[Mt,e("div",jt,[e("div",At,[Et,m(e("input",{type:"text",class:"form-control","onUpdate:modelValue":t[16]||(t[16]=n=>s.brand=n),placeholder:"Apple, Samsung..."},null,512),[[y,s.brand,void 0,{trim:!0}]])]),e("div",Lt,[qt,m(e("input",{type:"text",class:"form-control","onUpdate:modelValue":t[17]||(t[17]=n=>s.model=n)},null,512),[[y,s.model,void 0,{trim:!0}]])]),e("div",Gt,[Kt,e("div",Ot,[m(e("input",{class:"form-control","onUpdate:modelValue":t[18]||(t[18]=n=>D.value=n),onKeyup:_e(H,["enter"]),placeholder:"Nhập từ khóa rồi Enter"},null,40,Rt),[[y,D.value,void 0,{trim:!0}]]),e("button",{class:"btn btn-outline-secondary",type:"button",onClick:H},"Thêm")]),e("div",zt,[(d(!0),c(A,null,E(s.tags,(n,a)=>(d(),c("span",{key:a,class:"badge rounded-pill text-bg-light me-2"},[h("#"+v(n)+" ",1),e("button",{type:"button",class:"btn-close btn-close-white ms-1","aria-label":"Remove",onClick:r=>ne(a)},null,8,Ft)]))),128))])])])]),e("div",Ht,[Jt,e("div",Xt,[e("div",Wt,[Qt,m(e("select",{class:"form-select","onUpdate:modelValue":t[19]||(t[19]=n=>s.shipping.method=n)},ts,512),[[K,s.shipping.method]])]),s.shipping.method!=="meet"?(d(),c("div",ss,[ns,e("div",os,[ls,m(e("input",{type:"number",min:"0",step:"1000",class:"form-control","onUpdate:modelValue":t[20]||(t[20]=n=>s.shipping.fee=n)},null,512),[[y,s.shipping.fee,void 0,{number:!0}]])])])):_("",!0),e("div",as,[is,m(e("input",{type:"tel",class:"form-control","onUpdate:modelValue":t[21]||(t[21]=n=>s.contact.phone=n),placeholder:"09xx..."},null,512),[[y,s.contact.phone,void 0,{trim:!0}]])]),e("div",cs,[e("div",ds,[m(e("input",{class:"form-check-input",type:"checkbox",id:"hidePhone","onUpdate:modelValue":t[22]||(t[22]=n=>s.contact.hidePhone=n)},null,512),[[O,s.contact.hidePhone]]),rs])])])]),e("div",us,[e("div",ps,[m(e("input",{class:"form-check-input",type:"checkbox",id:"policy","onUpdate:modelValue":t[23]||(t[23]=n=>q.value=n)},null,512),[[O,q.value]]),hs]),I.value?(d(),c("div",ms,"Bạn cần đồng ý điều khoản trước khi đăng.")):_("",!0)]),e("div",_s,[e("button",{type:"button",class:"btn btn-outline-secondary",onClick:W},"Lưu nháp"),e("button",{type:"submit",class:"btn btn-success",disabled:w.value},v(w.value?"Đang đăng...":"Đăng bán"),9,gs)])])],40,ke)]),e("div",bs,[e("div",vs,[e("div",fs,[ys,f.value[0]?(d(),c("div",ks,[e("img",{src:f.value[0].url,class:"w-100 rounded-3",alt:"Ảnh bìa"},null,8,xs)])):_("",!0),e("ul",ws,[e("li",Ss,[Vs,h(),e("b",null,v(s.title||"—"),1)]),e("li",Cs,[Ts,h(),e("b",null,v(le(s.category)||"—"),1)]),e("li",Us,[$s,h(),e("b",null,v(oe.value),1)]),e("li",Is,[Bs,h(),e("b",null,v(s.location||"—"),1)])]),s.tags.length?(d(),c("div",Ds,[(d(!0),c(A,null,E(s.tags,(n,a)=>(d(),c("span",{key:a,class:"badge rounded-pill text-bg-light me-2"},"#"+v(n),1))),128))])):_("",!0)])])])])])}}},Ms=ce(Ns,[["__scopeId","data-v-77501921"]]);export{Ms as default};
