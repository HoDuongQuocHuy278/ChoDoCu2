import{_ as g,l as m,a as y,c as r,b as e,w as f,j as b,g as d,t as u,h as p,F as v,r as k,o as c,n as x,E as C,p as w,k as S}from"./index-01669123.js";const T={name:"ListChat",setup(){return{router:m()}},data(){return{API_BASE_URL:"/api/client",chats:[],loading:!1,searchQuery:"",selectedChatId:null}},computed:{filteredChats(){if(!this.searchQuery.trim())return this.chats;const t=this.searchQuery.toLowerCase();return this.chats.filter(a=>{const l=(a.name||a.participant_name||"").toLowerCase(),h=(a.last_message||"").toLowerCase(),i=(a.product_title||"").toLowerCase();return l.includes(t)||h.includes(t)||i.includes(t)})}},mounted(){this.checkAuth(),this.fetchChats()},methods:{checkAuth(){localStorage.getItem("key_client")||this.$router.push("/dang-nhap")},async fetchChats(){var t,a,l,h;this.loading=!0;try{const i=localStorage.getItem("key_client");if(!i){this.$router.push("/dang-nhap");return}const{data:n}=await y.get(`${this.API_BASE_URL}/chat`,{headers:{Authorization:`Bearer ${i}`}});n!=null&&n.status&&((t=n==null?void 0:n.data)!=null&&t.data)?this.chats=n.data.data:this.chats=[]}catch(i){console.error("Lỗi khi tải danh sách chat:",i),((a=i.response)==null?void 0:a.status)===401?this.$router.push("/dang-nhap"):(h=(l=this.$toast)==null?void 0:l.error)==null||h.call(l,"Không thể tải danh sách chat. Vui lòng thử lại sau."),this.chats=[]}finally{this.loading=!1}},selectChat(t){this.selectedChatId=t.id,this.$router.push(`/chat/${t.id}`)},handleNewChat(){var t,a;(a=(t=this.$toast)==null?void 0:t.info)==null||a.call(t,"Tính năng đang phát triển")},handleSearch(){},clearSearch(){this.searchQuery=""},handleChatAction(t){var a,l;(l=(a=this.$toast)==null?void 0:a.info)==null||l.call(a,"Tính năng đang phát triển")},formatTime(t){if(!t)return"";const a=new Date(t),h=new Date-a,i=Math.floor(h/6e4),n=Math.floor(h/36e5),s=Math.floor(h/864e5);return i<1?"Vừa xong":i<60?`${i} phút`:n<24?`${n} giờ`:s<7?`${s} ngày`:a.toLocaleDateString("vi-VN",{day:"2-digit",month:"2-digit"})},formatPreview(t){return t?t.length>50?t.substring(0,50)+"...":t:""},onAvatarError(t){t.target.style.display="none",t.target.nextElementSibling&&(t.target.nextElementSibling.style.display="flex")}}},o=t=>(w("data-v-b3e781ac"),t=t(),S(),t),A={class:"chat-list-container"},I={class:"chat-list-header"},L=o(()=>e("div",{class:"header-content"},[e("h1",{class:"page-title"},[e("i",{class:"bx bx-message-rounded-dots"}),p(" Tin nhắn của tôi ")]),e("p",{class:"page-subtitle"},"Quản lý các cuộc trò chuyện của bạn")],-1)),Q=o(()=>e("i",{class:"bx bx-plus"},null,-1)),E=o(()=>e("span",null,"Tin nhắn mới",-1)),N=[Q,E],B={class:"search-section"},M={class:"search-wrapper"},V=o(()=>e("i",{class:"bx bx-search search-icon"},null,-1)),D=o(()=>e("i",{class:"bx bx-x"},null,-1)),P=[D],R={class:"chat-list-wrapper"},U={key:0,class:"loading-state"},q=o(()=>e("div",{class:"loading-spinner"},null,-1)),z=o(()=>e("p",null,"Đang tải danh sách chat...",-1)),F=[q,z],H={key:1,class:"empty-state"},K=o(()=>e("div",{class:"empty-icon"},[e("i",{class:"bx bx-message-square-x"})],-1)),j=o(()=>e("i",{class:"bx bx-plus"},null,-1)),G={key:2,class:"chat-list"},J=["onClick"],O={class:"chat-avatar"},W=["src","alt"],X={key:1,class:"avatar-placeholder"},Y=o(()=>e("i",{class:"bx bx-user"},null,-1)),Z=[Y],$={key:2,class:"online-indicator"},tt={class:"chat-info"},et={class:"chat-header-row"},st={class:"chat-name"},at={class:"chat-time"},nt={class:"chat-preview-row"},it={class:"chat-preview"},rt={key:0,class:"bx bx-image"},ct={key:1,class:"bx bx-file"},ot=["innerHTML"],lt={key:0,class:"unread-badge"},ht={key:0,class:"chat-product"},dt=o(()=>e("i",{class:"bx bx-package"},null,-1)),ut=["onClick"],_t=o(()=>e("i",{class:"bx bx-dots-vertical-rounded"},null,-1)),pt=[_t];function gt(t,a,l,h,i,n){return c(),r("div",A,[e("div",I,[L,e("button",{class:"btn-new-chat",onClick:a[0]||(a[0]=(...s)=>n.handleNewChat&&n.handleNewChat(...s)),title:"Tạo cuộc trò chuyện mới"},N)]),e("div",B,[e("div",M,[V,f(e("input",{"onUpdate:modelValue":a[1]||(a[1]=s=>i.searchQuery=s),type:"text",placeholder:"Tìm kiếm cuộc trò chuyện...",class:"search-input",onInput:a[2]||(a[2]=(...s)=>n.handleSearch&&n.handleSearch(...s))},null,544),[[b,i.searchQuery]]),i.searchQuery?(c(),r("button",{key:0,class:"btn-clear-search",onClick:a[3]||(a[3]=(...s)=>n.clearSearch&&n.clearSearch(...s))},P)):d("",!0)])]),e("div",R,[i.loading?(c(),r("div",U,F)):n.filteredChats.length===0?(c(),r("div",H,[K,e("h3",null,u(i.searchQuery?"Không tìm thấy cuộc trò chuyện":"Chưa có cuộc trò chuyện nào"),1),e("p",null,u(i.searchQuery?"Thử tìm kiếm với từ khóa khác":"Bắt đầu trò chuyện với người bán hoặc người mua"),1),i.searchQuery?d("",!0):(c(),r("button",{key:0,class:"btn-start-chat",onClick:a[4]||(a[4]=(...s)=>n.handleNewChat&&n.handleNewChat(...s))},[j,p(" Tạo cuộc trò chuyện đầu tiên ")]))])):(c(),r("div",G,[(c(!0),r(v,null,k(n.filteredChats,s=>(c(),r("div",{key:s.id,class:x(["chat-item",{active:i.selectedChatId===s.id,unread:s.unread_count>0}]),onClick:_=>n.selectChat(s)},[e("div",O,[s.avatar?(c(),r("img",{key:0,src:s.avatar,alt:s.name,onError:a[5]||(a[5]=(..._)=>n.onAvatarError&&n.onAvatarError(..._))},null,40,W)):(c(),r("div",X,Z)),s.is_online?(c(),r("span",$)):d("",!0)]),e("div",tt,[e("div",et,[e("h3",st,u(s.name||s.participant_name),1),e("span",at,u(n.formatTime(s.last_message_time)),1)]),e("div",nt,[e("p",it,[s.last_message_type==="image"?(c(),r("i",rt)):s.last_message_type==="file"?(c(),r("i",ct)):d("",!0),e("span",{innerHTML:n.formatPreview(s.last_message)},null,8,ot)]),s.unread_count>0?(c(),r("span",lt,u(s.unread_count>99?"99+":s.unread_count),1)):d("",!0)]),s.product_title?(c(),r("div",ht,[dt,e("span",null,u(s.product_title),1)])):d("",!0)]),e("button",{class:"btn-chat-action",onClick:C(_=>n.handleChatAction(s),["stop"]),title:"Tùy chọn"},pt,8,ut)],10,J))),128))]))])])}const yt=g(T,[["render",gt],["__scopeId","data-v-b3e781ac"]]);export{yt as default};
