import{_ as p,a as d,c as o,b as t,w as g,j as f,i as y,z as P,F as v,r as k,t as l,g as b,o as c,n as _,p as A,k as I}from"./index-01669123.js";import{a as u,A as S}from"./config-162ba8a8.js";const C={name:"AdminProducts",data(){return{products:[],searchQuery:"",filterStatus:"all",currentPage:1,totalPages:1}},mounted(){this.fetchProducts()},methods:{async fetchProducts(){try{const a=localStorage.getItem("token"),e=await d.get(`${u}/products`,{params:{page:this.currentPage,q:this.searchQuery,trang_thai:this.filterStatus},headers:{Authorization:`Bearer ${a}`}});e.data.status&&(this.products=e.data.data.data,this.totalPages=e.data.data.last_page)}catch(a){console.error("Error fetching products:",a)}},getProductImage(a){if(a.hinh_anh)try{const e=JSON.parse(a.hinh_anh);return Array.isArray(e)&&e.length>0?S+e[0]:"https://via.placeholder.com/50"}catch{return"https://via.placeholder.com/50"}return"https://via.placeholder.com/50"},formatCurrency(a){return new Intl.NumberFormat("vi-VN",{style:"currency",currency:"VND"}).format(a)},async toggleActive(a){try{const e=localStorage.getItem("token"),h=await d.post(`${u}/products/${a.id}/toggle`,{},{headers:{Authorization:`Bearer ${e}`}});h.data.status&&(a.trang_thai=a.trang_thai==1?3:1,alert(h.data.message))}catch(e){console.error("Error toggling product:",e),alert("Lỗi khi thay đổi trạng thái")}},async deleteProduct(a){if(confirm("Bạn có chắc muốn xóa sản phẩm này?"))try{const e=localStorage.getItem("token");await d.delete(`${u}/products/${a.id}`,{headers:{Authorization:`Bearer ${e}`}}),this.fetchProducts(),alert("Xóa sản phẩm thành công")}catch(e){console.error("Error deleting product:",e),alert("Lỗi khi xóa sản phẩm")}},changePage(a){this.currentPage=a,this.fetchProducts()}}},i=a=>(A("data-v-174a18a0"),a=a(),I(),a),x={class:"products-page"},w=i(()=>t("h2",{class:"page-title"},"Quản lý sản phẩm",-1)),N={class:"toolbar"},B=i(()=>t("option",{value:"all"},"Tất cả trạng thái",-1)),T=i(()=>t("option",{value:"1"},"Đang bán",-1)),V=i(()=>t("option",{value:"3"},"Đã ẩn",-1)),z=[B,T,V],D={class:"table-container"},L={class:"data-table"},Q=i(()=>t("thead",null,[t("tr",null,[t("th",null,"ID"),t("th",null,"Hình ảnh"),t("th",null,"Tên sản phẩm"),t("th",null,"Giá"),t("th",null,"Người bán"),t("th",null,"Trạng thái"),t("th",null,"Hành động")])],-1)),E=["src"],U={class:"product-name"},F={key:0},H={key:1},M={class:"actions"},K=["onClick","title"],R=["onClick"],X=i(()=>t("i",{class:"fas fa-trash"},null,-1)),j=[X],q={key:0,class:"pagination"},G=["disabled"],J=["disabled"];function O(a,e,h,W,n,r){return c(),o("div",x,[w,t("div",N,[g(t("input",{type:"text","onUpdate:modelValue":e[0]||(e[0]=s=>n.searchQuery=s),onKeyup:e[1]||(e[1]=y((...s)=>r.fetchProducts&&r.fetchProducts(...s),["enter"])),placeholder:"Tên sản phẩm, mô tả...",class:"search-input"},null,544),[[f,n.searchQuery]]),g(t("select",{"onUpdate:modelValue":e[2]||(e[2]=s=>n.filterStatus=s),onChange:e[3]||(e[3]=(...s)=>r.fetchProducts&&r.fetchProducts(...s)),class:"status-filter"},z,544),[[P,n.filterStatus]]),t("button",{onClick:e[4]||(e[4]=(...s)=>r.fetchProducts&&r.fetchProducts(...s)),class:"btn btn-primary"},"Tìm kiếm")]),t("div",D,[t("table",L,[Q,t("tbody",null,[(c(!0),o(v,null,k(n.products,s=>(c(),o("tr",{key:s.id},[t("td",null,l(s.id),1),t("td",null,[t("img",{src:r.getProductImage(s),alt:"Product",class:"product-thumb"},null,8,E)]),t("td",null,[t("div",U,l(s.ten_san_pham),1),t("small",null,l(s.category),1)]),t("td",null,l(r.formatCurrency(s.gia)),1),t("td",null,[s.khach_hang?(c(),o("div",F,[t("div",null,l(s.khach_hang.ho_va_ten),1),t("small",null,l(s.khach_hang.email),1)])):(c(),o("span",H,"Admin"))]),t("td",null,[t("span",{class:_(["status-badge",s.trang_thai==1?"active":"inactive"])},l(s.trang_thai==1?"Đang bán":"Đã ẩn"),3)]),t("td",M,[t("button",{onClick:m=>r.toggleActive(s),class:"btn-icon",title:s.trang_thai==1?"Ẩn sản phẩm":"Hiện sản phẩm"},[t("i",{class:_(["fas",s.trang_thai==1?"fa-eye-slash":"fa-eye"])},null,2)],8,K),t("button",{onClick:m=>r.deleteProduct(s),class:"btn-icon delete",title:"Xóa"},j,8,R)])]))),128))])])]),n.totalPages>1?(c(),o("div",q,[t("button",{disabled:n.currentPage===1,onClick:e[5]||(e[5]=s=>r.changePage(n.currentPage-1))}," « ",8,G),t("span",null,"Trang "+l(n.currentPage)+" / "+l(n.totalPages),1),t("button",{disabled:n.currentPage===n.totalPages,onClick:e[6]||(e[6]=s=>r.changePage(n.currentPage+1))}," » ",8,J)])):b("",!0)])}const $=p(C,[["render",O],["__scopeId","data-v-174a18a0"]]);export{$ as default};
