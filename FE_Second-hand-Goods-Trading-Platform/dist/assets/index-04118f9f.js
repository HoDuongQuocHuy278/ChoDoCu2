import{_ as p,a as d,c as h,b as e,w as k,j as m,i as b,F as f,r as y,t as l,g as v,o as u,z as P,n as _,p as U,k as C}from"./index-01669123.js";import{a as g}from"./config-162ba8a8.js";const x={name:"AdminUsers",data(){return{users:[],searchQuery:"",currentPage:1,totalPages:1}},mounted(){this.fetchUsers()},methods:{async fetchUsers(){try{const n=localStorage.getItem("token"),t=await d.get(`${g}/users`,{params:{page:this.currentPage,q:this.searchQuery},headers:{Authorization:`Bearer ${n}`}});t.data.status&&(this.users=t.data.data.data,this.totalPages=t.data.data.last_page)}catch(n){console.error("Error fetching users:",n)}},async updateRole(n){try{const t=localStorage.getItem("token");await d.post(`${g}/users/${n.id}/role`,{role:n.role},{headers:{Authorization:`Bearer ${t}`}}),alert("Cập nhật quyền thành công!")}catch(t){console.error("Error updating role:",t),alert("Lỗi khi cập nhật quyền")}},async toggleBlock(n){if(confirm(`Bạn có chắc muốn ${n.is_block?"mở khóa":"khóa"} tài khoản này?`))try{const t=localStorage.getItem("token"),c=await d.post(`${g}/users/${n.id}/block`,{},{headers:{Authorization:`Bearer ${t}`}});c.data.status&&(n.is_block=!n.is_block,alert(c.data.message))}catch(t){console.error("Error toggling block:",t),alert("Lỗi khi thay đổi trạng thái")}},async deleteUser(n){if(confirm("Bạn có chắc muốn xóa người dùng này? Hành động này không thể hoàn tác!"))try{const t=localStorage.getItem("token");(await d.delete(`${g}/users/${n.id}`,{headers:{Authorization:`Bearer ${t}`}})).data.status&&(this.fetchUsers(),alert("Xóa người dùng thành công"))}catch(t){console.error("Error deleting user:",t),alert("Lỗi khi xóa người dùng")}},changePage(n){this.currentPage=n,this.fetchUsers()}}},r=n=>(U("data-v-98bb67e5"),n=n(),C(),n),B={class:"users-page"},I=r(()=>e("h2",{class:"page-title"},"Quản lý người dùng",-1)),S={class:"toolbar"},w={class:"table-container"},A={class:"data-table"},z=r(()=>e("thead",null,[e("tr",null,[e("th",null,"ID"),e("th",null,"Họ tên"),e("th",null,"Email"),e("th",null,"SĐT"),e("th",null,"Vai trò"),e("th",null,"Trạng thái"),e("th",null,"Hành động")])],-1)),E=["onUpdate:modelValue","onChange"],T=r(()=>e("option",{value:0},"User",-1)),V=r(()=>e("option",{value:1},"Admin",-1)),L=[T,V],Q={class:"actions"},D=["onClick","title"],H=["onClick"],M=r(()=>e("i",{class:"fas fa-trash"},null,-1)),q=[M],K={key:0,class:"pagination"},N=["disabled"],R=["disabled"];function F(n,t,c,X,a,o){return u(),h("div",B,[I,e("div",S,[k(e("input",{type:"text","onUpdate:modelValue":t[0]||(t[0]=s=>a.searchQuery=s),onKeyup:t[1]||(t[1]=b((...s)=>o.fetchUsers&&o.fetchUsers(...s),["enter"])),placeholder:"Tìm kiếm theo tên, email, sđt...",class:"search-input"},null,544),[[m,a.searchQuery]]),e("button",{onClick:t[2]||(t[2]=(...s)=>o.fetchUsers&&o.fetchUsers(...s)),class:"btn btn-primary"},"Tìm kiếm")]),e("div",w,[e("table",A,[z,e("tbody",null,[(u(!0),h(f,null,y(a.users,s=>(u(),h("tr",{key:s.id},[e("td",null,l(s.id),1),e("td",null,l(s.ho_va_ten),1),e("td",null,l(s.email),1),e("td",null,l(s.so_dien_thoai),1),e("td",null,[k(e("select",{"onUpdate:modelValue":i=>s.role=i,onChange:i=>o.updateRole(s),class:_(["role-select",{admin:s.role==1}])},L,42,E),[[P,s.role]])]),e("td",null,[e("span",{class:_(["status-badge",s.is_block?"blocked":"active"])},l(s.is_block?"Đã khóa":"Hoạt động"),3)]),e("td",Q,[e("button",{onClick:i=>o.toggleBlock(s),class:"btn-icon",title:s.is_block?"Mở khóa":"Khóa"},[e("i",{class:_(["fas",s.is_block?"fa-unlock":"fa-lock"])},null,2)],8,D),e("button",{onClick:i=>o.deleteUser(s),class:"btn-icon delete",title:"Xóa"},q,8,H)])]))),128))])])]),a.totalPages>1?(u(),h("div",K,[e("button",{disabled:a.currentPage===1,onClick:t[3]||(t[3]=s=>o.changePage(a.currentPage-1))}," « ",8,N),e("span",null,"Trang "+l(a.currentPage)+" / "+l(a.totalPages),1),e("button",{disabled:a.currentPage===a.totalPages,onClick:t[4]||(t[4]=s=>o.changePage(a.currentPage+1))}," » ",8,R)])):v("",!0)])}const G=p(x,[["render",F],["__scopeId","data-v-98bb67e5"]]);export{G as default};
